name: Build Static Page and Deploy
on: # 监听 main 分支上的 push 事件
  #push:
   # branches:
   #   - main
  #release:
    #types: [created] # 表示在创建新的 Release 时触发
  workflow_dispatch:
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # 构建环境使用 ubuntu
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          persist-credentials: false
      - name: Set up Node
        uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'
          cache-dependency-path: './pnpm-lock.yaml'
      - name: Install  # 下载依赖 打包项目
        run: |
          npm install
          npm install pnpm -g      
          pnpm install
      - name: Build
        run:
          pnpm run build
      - name: Create Zip Archive
        run: zip -r page.zip dist/

      - name: Upload Release Artifact
        uses: actions/upload-artifact@v2.2.4
        with:
          name: Release Artifact
          path: page.zip
      - name: Create release
        id: create_release
        uses: actions/create-release@v1
        env: 
           GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        with:
           tag_name: pagefile
           release_name: Release pagefile
           draft: false
           prerelease: false
      - name: Upload release asset
        id: upload-release-asset
        uses: actions/upload-release-asset@v1
        env: 
           GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        with:
           upload_url: ${{ steps.create_release.outputs.upload_url }}
           asset_path: ./page.zip
           asset_name: page.zip
           asset_content_type: application/zip
       
          
          
